# Система прогрессии упражнений

## Обзор

Реализована полноценная система автоматических рекомендаций (suggestions) для подходов в упражнениях. Система анализирует личные рекорды пользователя и тип упражнения, затем предлагает оптимальные значения для веса, количества повторений или длительности.

## Что реализовано

### 1. Типы и интерфейсы (`lib/types/progression.ts`)

- `ProgressionLogicType` - типы логик прогрессии
- `SetSuggestion` - интерфейс для рекомендации подхода
- `LinearLoadProgressionConfig` - конфигурация линейной прогрессии
- `PercentageBasedProgressionConfig` - конфигурация процентной прогрессии
- `ExerciseSuggestions` - результат расчета рекомендаций

### 2. Логики прогрессии

#### Linear Load Progression (`lib/progression/linear-load.ts`)

**Для упражнений с весом** (штанга, гантели)

Логика работы:
- Подход 1: Пустой гриф (20 кг) × 10 повторений
- Подход 2-5: Прогрессивное увеличение от 40% до 100% максимального веса

**Пример 1** - Рекорд 100 кг × 8 повторений:
```
Подход 1: 20 кг × 10 повторений (пустой гриф)
Подход 2: 40 кг × 10 повторений (40% от макс)
Подход 3: 60 кг × 10 повторений (60% от макс)
Подход 4: 80 кг × 8 повторений (80% от макс)
Подход 5: 100 кг × 8 повторений (100% от макс)
```

**Пример 2** - Рекорд 30 кг × 10 повторений (демонстрация минимального веса):
```
Подход 1: 20 кг × 10 повторений (пустой гриф)
Подход 2: 20 кг × 10 повторений (40% = 12 кг → 20 кг минимум)
Подход 3: 20 кг × 10 повторений (60% = 18 кг → 20 кг минимум)
Подход 4: 24 кг × 10 повторений (80% от макс)
Подход 5: 30 кг × 10 повторений (100% от макс)
```

> **Важная корректировка:** Вес не может быть меньше веса пустого грифа (по умолчанию 20 кг). Если расчетный процент дает значение меньше 20 кг, система автоматически устанавливает минимум 20 кг. Это особенно важно для начинающих с небольшими рекордами.

#### Percentage-Based Progression (`lib/progression/percentage-based.ts`)

**Для упражнений без веса** (подтягивания, отжимания, приседания)

Логика работы:
- Подход 1: 30% от максимального количества повторений
- Подход 2: 60% от максимума
- Подход 3+: 100% от максимума

Пример для рекорда 20 повторений:
```
Подход 1: 6 повторений (30% от макс)
Подход 2: 12 повторений (60% от макс)
Подход 3: 20 повторений (100% от макс)
```

#### Duration-Based Progression (`lib/progression/duration-based.ts`)

**Для упражнений на время** (планки, удержания)

Логика работы:
- Подход 1: 50% от максимального времени
- Подход 2: 75% от максимума
- Подход 3+: 100% от максимума

Пример для рекорда 60 секунд:
```
Подход 1: 30 секунд (50% от макс)
Подход 2: 45 секунд (75% от макс)
Подход 3: 60 секунд (100% от макс)
```

### 3. Главная функция (`lib/progression/index.ts`)

Функция `calculateSetSuggestion()` автоматически определяет тип упражнения по тегам и применяет соответствующую логику:

- Тег `duration` → Duration-Based Progression
- Тег `weight` → Linear Load Progression
- Без специальных тегов → Percentage-Based Progression

### 4. Готовые конфигурации (`lib/progression/configs.ts`)

Предустановленные конфигурации для разных сценариев:

**Для упражнений с весом:**
- `STANDARD_LINEAR` - стандартная прогрессия
- `AGGRESSIVE_LINEAR` - быстрее к рабочему весу
- `CONSERVATIVE_LINEAR` - больше разминочных подходов
- `LIGHT_WEIGHT_LINEAR` - для легких весов и гантелей

**Для упражнений без веса:**
- `STANDARD_PERCENTAGE` - стандартная прогрессия
- `HIGH_VOLUME_PERCENTAGE` - больше подходов
- `BEGINNER_PERCENTAGE` - для начинающих
- `ADVANCED_PERCENTAGE` - для опытных

### 5. Интеграция с воркаутом (`app/workout/[id]/page.tsx`)

Воркаут теперь автоматически:
1. Загружает рекорды пользователя при старте упражнения
2. Рассчитывает suggestions для текущего подхода
3. Подставляет значения в инпуты (вес/повторы/длительность)
4. Обновляет suggestions при переходе к следующему подходу

Пользователь всегда может вручную изменить предложенные значения.

### 6. Примеры использования (`lib/progression/examples.ts`)

Готовые примеры для:
- Жима лежа (Linear Load)
- Подтягиваний (Percentage-Based)
- Планки (Duration-Based)
- Новых упражнений без рекордов
- Автоматического определения типа

## Как это работает

### Пример сценария: Жим лежа

1. Пользователь начинает тренировку
2. Переходит к упражнению "Жим лежа" (теги: `weight`, `push`, `chest`)
3. Система загружает рекорд: **100 кг × 8 повторений**
4. Для первого подхода система предлагает: **20 кг × 10 повторений** (пустой гриф)
5. Пользователь выполняет подход и переходит ко второму
6. Система предлагает: **40 кг × 10 повторений** (40% от макс)
7. И так далее до рабочего веса

### Обработка отсутствующих рекордов

Если у пользователя нет рекорда, система использует консервативные начальные значения:

- **Упражнения с весом**: 20, 30, 40, 50, 60 кг
- **Упражнения без веса**: 5, 10, 15 повторений
- **Упражнения на время**: 15, 30, 45 секунд

## Использование в коде

```typescript
import { calculateSetSuggestion } from '@/lib/progression'
import { getExerciseRecord } from '@/lib/supabase/queries'

// В компоненте воркаута
const exercise = exercises[currentExercise]
const exerciseId = exercise.exerciseId || exercise.id
const exerciseTags = exercise.tags || []

// Получаем рекорд пользователя
const record = await getExerciseRecord(userId, exerciseId)

// Рассчитываем suggestion для текущего подхода
const suggestion = calculateSetSuggestion({
  exerciseId,
  exerciseTags,
  setNumber: currentSet,
  record,
})

// Применяем к инпутам
setWeight(String(suggestion.weight))
setReps(String(suggestion.reps))
setDuration(String(suggestion.duration))
```

## Преимущества системы

1. **Автоматизация** - пользователю не нужно думать о весах и повторах
2. **Персонализация** - suggestions основаны на личных рекордах
3. **Безопасность** - постепенное увеличение нагрузки с разминкой
4. **Гибкость** - пользователь может изменить любые значения
5. **Расширяемость** - легко добавить новые логики прогрессии

## Структура файлов

```
lib/
├── types/
│   └── progression.ts          # Типы и интерфейсы
└── progression/
    ├── index.ts                # Главная функция
    ├── linear-load.ts          # Логика для упражнений с весом
    ├── percentage-based.ts     # Логика для bodyweight упражнений
    ├── duration-based.ts       # Логика для упражнений на время
    ├── configs.ts              # Готовые конфигурации
    ├── examples.ts             # Примеры использования
    └── README.md               # Документация
```

## Будущие улучшения

- [ ] Сохранение предпочитаемой логики прогрессии для каждого упражнения
- [ ] UI для выбора логики прогрессии в настройках
- [ ] Логика Reverse Pyramid (от тяжелого к легкому)
- [ ] Логика Wave Loading (волнообразная нагрузка)
- [ ] Учет усталости (снижение весов в конце тренировки)
- [ ] A/B тестирование разных логик прогрессии
- [ ] Персонализация процентов на основе истории тренировок
- [ ] График прогресса с визуализацией suggestions vs фактических результатов

## Тестирование

Для тестирования системы можно запустить примеры:

```typescript
import { runAllExamples } from '@/lib/progression/examples'

// Запустить все примеры в консоли
runAllExamples()
```

Или протестировать отдельные функции:

```typescript
import { exampleBenchPress, examplePullUps, examplePlank } from '@/lib/progression/examples'

exampleBenchPress()  // Пример с весом
examplePullUps()     // Пример без веса
examplePlank()       // Пример на время
```

## Заключение

Система прогрессии полностью интегрирована в приложение и готова к использованию. Она автоматически подбирает оптимальные значения для каждого подхода, делая тренировки более эффективными и безопасными.

